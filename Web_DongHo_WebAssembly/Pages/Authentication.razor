@page "/authentication"
@inject IJSRuntime JS
@inject NavigationManager Navigation
@inject AuthState AuthState
@using System.IdentityModel.Tokens.Jwt;
@code {
    protected override async Task OnInitializedAsync()
    {
        var uri = new Uri(Navigation.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
        var token = query["token"];

        if (!string.IsNullOrEmpty(token))
        {
            await JS.InvokeVoidAsync("localStorage.setItem", "authToken", token);

            var handler = new JwtSecurityTokenHandler();
            var decodedToken = handler.ReadJwtToken(token);
            var username = decodedToken.Claims.FirstOrDefault(c => c.Type == "Name")?.Value;

            AuthState.IsLoggedIn = true;
            AuthState.Username = username;
        }

        Navigation.NavigateTo("/");
    }
}
